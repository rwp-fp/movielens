---
title: "Movielens Project"
author: "Richard"
date: "15/08/2021"
output: pdf_document
---

```{r read in data, echo=FALSE}
#set option to remove ## from all R output
knitr::opts_chunk$set(comment = NA)

#Read in datasets generated by R code - saved in script as CSVs

#edx is 10 lines of the edx dataset including the predictors generated
edx <- read.csv("https://raw.githubusercontent.com/rwp-fp/movielens/master/edx.csv")

#validation is 10 lines of the validation dataset including the predictors generated
validation <- read.csv("https://raw.githubusercontent.com/rwp-fp/movielens/master/validation.csv")

#Results_Tracker is the file containing the RMSE figures for each of
#the predictors used when testing the methodology
Results_Tracker <- read.csv("https://raw.githubusercontent.com/rwp-fp/movielens/master/Results_Tracker.csv")

#Results_Tracker_Validation is the RMSE figure generated when running the
#script against the validation dataset
Results_Tracker_Validation <- read.csv("https://raw.githubusercontent.com/rwp-fp/movielens/master/Results_Tracker_Validation.csv")

#Years_Since_Summary is the figures showing the impact of the years since movie release on the rating
Years_Since_Summary <- read.csv("https://raw.githubusercontent.com/rwp-fp/movielens/master/years_since_summay.csv")

```

# Movielens Project

## Executive Summary

This report presents a summary of a project completed as the final part of the **HarvardX Data Science Program**. The project uses the data analysis and R programming skills learned during the program to estimate the ratings given to movies based on a range of predictors.

The project uses a dataset of 10 million ratings of movies. All movies are given a rating between 0 and 5. The aim of the project is to develop a methodology and R code which correctly predicts the rating a movie will receive.

The methodology I developed uses a range of predictors to estimate the rating a movie will receive. The starting point for the prediction is the average rating across all movies, this is:

```{r print mean, echo=FALSE}
#Print the average rating given to all films in the edx dataset
cat(edx[1,]$pred_mean)

```

A range of predictors are then used to work out how the estimated rating may vary from this average. The predictors used are:

1.  The average rating given to a **specific movie**.

2.  The average rating given by a **specific user** (the person providing the rating)

3.  The **amount of time (in years) between a movie's release and the date the rating is given**.

4.  The **genre** of the film.

5.  The **day of the week** that a movie rating is given.

The predictors are then used to generate an estimated rating for each movie. The accuracy of the prediction is measured using a validation dataset which contains 1 million movie ratings. An estimated rating is calculated for each movie in the validation dataset, this is then compared against the actual rating given to the movie.

A root mean square error measurement (RMSE) is used to establish the accuracy of the estimated rating. This measures the average difference between the actual and estimated rating for the movie.

The methodology and code I produced resulted in the following RMSE measurement when run against the movies in the validation dataset:

```{r print RMSE, echo=FALSE}
#print the final RMSE figure obtained from the validation dataset
cat(Results_Tracker_Validation$RMSE)

```

## Method Used

The edx dataset contains just over 9 million movie ratings. The methodology for estimating ratings was tested using this dataset, leaving the validation dataset, which contains around 1 million ratings, to be used only to test the final methodology developed.

The edx dataset was split into a training dataset, containing around 80% of the movie ratings, and a test dataset, containing the remaining 20%. The test dataset allowed possible approaches to predict ratings to be trialled (meaning the validation dataset did not need to be used).

The starting point for the predicted rating is the average (mean) rating for all movies in the dataset. Other predictors are then used to measure the amount that they effect how a movie's rating varies from this average.

The script tested the impact of several predictors on the rating a movie was given. The difference between the actual rating and estimated rating was measured using the Root Mean Square Error - this provides a measure of the accuracy of the estimated rating.

The first predictor applied is the **Movie Average**. This uses the average rating given by all users for a specific movie. This establishes whether, on average, users rate the movie highly or not. Highly rated movies higher than average ratings, and so the movies average predictor measures this and adjusts the estimated rating up or down accordingly.

The next predictor applied is the **User Average**. This establishes the average rating a specific users gives to the movies they rate. This establishes whether, on average, a user tends to award ratings that are higher/lower than the average. This information can then be used to adjust the estimated rating up or down.

The **Years Since Release** predictor adjusts the estimated rating based on the amount of time between a movie being released and the date the rating is given. This assumes that movies that are rated several years after their release are viewed as "classics" are so are more likely to receive a higher rating. This is shown in the figure below, it can be seen how the average rating increases around 10 years following a movie's release.

```{r years since summary, echo = FALSE, message=FALSE, warning=FALSE, fig.width=6, fig.height=3}
#Use the summary of the years since release to dispay a plot showing impact
#on actual rating given.
library("ggplot2")
library("dplyr")
Years_Since_Summary %>% ggplot(aes(years_since_release,year_rating)) + geom_line(color = "darkorange") + labs(title = "Impact of the Time Since a Movie's Release on its Average Rating", x= "Years Since Release", y= "Average Rating")

```

In order to use this predictor it is necessary to determine the year that a movie is released. This information is contained in the movie title - the R script extracts this information and stores it as a new field in the data set. The timestamp of the rating is then used to calculate the number of years between the date of release and the date of the rating being given.

The next predictor applied is based on the movie's **genres**. The information on the genres associated with each movie is used to determine whether it has an impact on its rating. Some genres have a higher or lower rating than the average and so, again, this information can be used to adjust the estimated rating up or down.

The final predictor is the **day of the week** a movie is rated. This information is extracted from the timestamp associated with a rating. The impact of the day of the week on the average rating is then calculated and used to alter the estimated rating.

```{r show all predictors, echo = FALSE}
#install the Kable package to allow table formatting
library(kableExtra)

Table_Text <- validation %>% head() %>% select(userId,movieId, rating, title,genres, pred_mean, movie_reg_predictor, user_reg_predictor, years_since_release,years_since_predictor, genre_reg_predictor, day_predictor, Final_Estimated_Rating)

colnames(Table_Text) <- c("UserID", "MovieID", "Actual Rating", "Movie Title", "Genres", "Mean Rating", "Movie Predictor", "User Predictor", "Years Since Release", "Years Since Release Predictor", "Genre Predictor", "Day Predictor", "Estimated Rating"  )

kable(Table_Text) %>%
  kable_styling(bootstrap_options = c("striped", "hover","condensed"), font_size =10, full_width = F, position = "left") 
```

## Results

## Conclusion

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
